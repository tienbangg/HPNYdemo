<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ti·∫øn B·∫±ng - H·ªôi Xu√¢n B√≠nh Ng·ªç 2026 - M√£ ƒê√°o Th√†nh C√¥ng</title>
    <style>
        :root { --gold-grad: linear-gradient(to bottom, #fff7ad 0%, #ffa700 50%, #ff4600 100%); --red-deep: #8b0000; }
        
        body {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            margin: 0; background: #000; color: #fff;
            font-family: 'Times New Roman', serif;
            overflow: hidden; height: 100vh; display: flex;
            justify-content: center; align-items: center; touch-action: none;
        }

        .bg-overlay {
            position: fixed; inset: 0;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.9)), 
                        url('https://png.pngtree.com/thumb_back/fh260/background/20251127/pngtree-2026-year-of-the-horse-red-and-gold-horse-background-image_20357168.webp');
            background-size: cover; background-position: center;
            z-index: -1; filter: saturate(1.5);
        }

        canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
        #canvas-fireworks { z-index: 5; }
        #canvas-petals { z-index: 2500; }

        .art-title {
            display: none; position: fixed; top: 5%; width: 100%; text-align: center;
            font-size: 3.5rem; font-weight: bold; z-index: 10;
            background: var(--gold-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,165,0,0.8));
            font-family: 'Playfair Display', serif; text-transform: uppercase;
        }

        #intro-screen {
            position: fixed; z-index: 5000; inset: 0; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle, rgba(0,0,0,0.3) 0%, #000 100%);
        }

        #timer {
            font-size: 18rem; font-weight: 900; background: var(--gold-grad);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 30px #ff4600); line-height: 1;
        }

        .touch-text {
            font-size: 1.8rem; color: #ffd700; letter-spacing: 8px;
            text-transform: uppercase; animation: shine 2s infinite;
            border: 2px solid #ffd700; padding: 15px 40px; border-radius: 50px;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        @keyframes shine { 0% { opacity: 0.4; box-shadow: 0 0 0px #ffd700; } 50% { opacity: 1; box-shadow: 0 0 30px #ffd700; } 100% { opacity: 0.4; box-shadow: 0 0 0px #ffd700; } }

        #name-input-box {
            display: none; background: rgba(139,0,0,0.9); padding: 40px;
            border: 5px double #ffd700; border-radius: 30px;
            box-shadow: 0 0 50px rgba(255,0,0,0.5); z-index: 6000; text-align: center;
            max-height: 80vh; overflow-y: auto; width: 320px;
        }
        #name-input-box input {
            padding: 12px; font-size: 1.3rem; border-radius: 10px; border: 2px solid #ffd700;
            background: #000; color: #fff; text-align: center; width: 80%; margin-bottom: 20px;
        }

        #admin-list-container {
            display: none; margin-top: 20px; background: rgba(0,0,0,0.8); 
            border-radius: 10px; padding: 10px; max-height: 250px; overflow-y: auto;
            border: 1px solid #ffd700;
        }
        .admin-table { width: 100%; border-collapse: collapse; color: #ffd700; font-size: 0.85rem; }
        .admin-table th, .admin-table td { border: 1px solid rgba(255,215,0,0.3); padding: 8px; text-align: left; }
        .admin-table th { background: rgba(255,215,0,0.2); text-align: center; }
        
        .btn-del { color: #ff4600; cursor: pointer; text-decoration: underline; font-weight: bold; }
        .btn-clear-all { 
            background: #ff4600; color: #fff; border: none; padding: 5px 10px; 
            border-radius: 5px; cursor: pointer; font-size: 0.7rem; margin-bottom: 10px;
            display: block; width: 100%;
        }

        #shaker-container {
            display: none; position: absolute; width: 140px; height: 250px;
            z-index: 1000; cursor: grab; flex-direction: column; align-items: center;
            left: 50%; top: 50%; transform: translate(-50%, -50%);
        }
        #tube {
            width: 130px; height: 180px; background: #8b0000; border: 4px solid #ffd700;
            border-radius: 10px 10px 60px 60px; position: relative; display: flex;
            justify-content: center; box-shadow: 0 30px 60px rgba(0,0,0,1);
        }
        #tube::after { content: "üßß"; position: absolute; top: 40%; font-size: 2rem; opacity: 0.3; }
        .stick { width: 10px; height: 110px; background: linear-gradient(to bottom, #ff0000, #440000); border: 1px solid #ffd700; position: absolute; top: -55px; border-radius: 3px; }

        .lixi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .lixi-item {
            width: 80px; height: 140px; 
            background: linear-gradient(145deg, #d40000 0%, #8b0000 100%);
            border: 2px solid #ffd700; border-radius: 8px; cursor: pointer;
            position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .lixi-item::before { content: "üå∏"; font-size: 2rem; position: absolute; top: 10px; color: #ffeb3b; filter: drop-shadow(0 0 5px gold); }
        .lixi-item::after { content: "T√†i L·ªôc"; position: absolute; bottom: 15px; width: 100%; text-align: center; font-size: 0.8rem; color: #ffd700; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .lixi-item:hover { transform: scale(1.1) rotate(3deg); box-shadow: 0 0 30px #ffd700; }
        .lixi-item:active { transform: scale(0.9); }

        .btn-gold {
            padding: 15px 35px; background: var(--gold-grad);
            color: #000; border: none; border-radius: 30px; font-weight: bold; 
            cursor: pointer; font-size: 1.1rem; text-transform: uppercase;
        }

        .shaking { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: rotate(0deg); } 50% { transform: rotate(5deg); } 100% { transform: rotate(-5deg); } }

        #curtain-container { position: fixed; inset: 0; z-index: 4500; display: none; pointer-events: none; }
        .curtain-panel { position: absolute; top: 0; width: 50%; height: 100%; background: #8b0000; background-image: repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(0,0,0,0.2) 45px); box-shadow: inset 0 0 100px #000; transition: transform 2.5s cubic-bezier(0.645, 0.045, 0.355, 1); border-bottom: 15px solid #ffd700; }
        .curtain-left { left: 0; border-right: 2px solid #ffd700; transform: translateX(0); }
        .curtain-right { right: 0; border-left: 2px solid #ffd700; transform: translateX(0); }
        .open-curtain .curtain-left { transform: translateX(-100%); }
        .open-curtain .curtain-right { transform: translateX(100%); }

        /* T√çNH NƒÇNG TH√çCH ·ª®NG (RESPONSIVE) B·ªî SUNG */
        @media screen and (max-width: 768px) {
            .art-title { font-size: 2rem; top: 8%; }
            #timer { font-size: 10rem; }
            .touch-text { font-size: 1.2rem; letter-spacing: 3px; padding: 10px 25px; }
            #name-input-box, #result-card { width: 85%; padding: 20px; box-sizing: border-box; }
            .lixi-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            #money-amount { font-size: 3.5rem; }
            #shaker-container { 
                /* ƒê·∫£m b·∫£o h·ªôp qu·∫ª th√≠ch ·ª©ng tr√™n Mobile */
                transform: translate(-50%, -50%) scale(0.8);
                top: 55%; 
            }
        }
        @media screen and (max-height: 600px) {
            .art-title { font-size: 1.5rem; }
            #timer { font-size: 7rem; }
            #name-input-box { padding: 15px; }
            #shaker-container { transform: translate(-50%, -50%) scale(0.6); }
        }
    </style>
</head>
<body oncontextmenu="return false;"> 
    <div id="curtain-container">
        <div class="curtain-panel curtain-left"></div>
        <div class="curtain-panel curtain-right"></div>
    </div>

    <div class="bg-overlay"></div>
    <audio id="bg-music" loop src="nhactet.mp3"></audio>

    <div id="intro-screen" onclick="showNameInput()">
        <div id="timer">5</div>
        <div class="touch-text">Ch·∫°m ƒë·ªÉ khai xu√¢n</div>
    </div>

    <div id="name-input-box">
        <h2 style="color: #ffd700; margin-top:0; font-size: 1.5rem;">QU√ù DANH T√ÇN NI√äN</h2>
        <input type="text" id="username" placeholder="Nh·∫≠p t√™n..." maxlength="15"><br>
        <button class="btn-gold" onclick="startCountdown()">KHAI H·ªòI B√çNH NG·ªå</button>
        
        <div style="margin-top: 25px;">
            <span onclick="toggleAdminPanel()" style="color: rgba(255,215,0,0.5); cursor: pointer; font-size: 0.85rem; text-decoration: underline;">
                Qu·∫£n l√Ω danh s√°ch (Admin)
            </span>
        </div>

        <div id="admin-list-container">
            <button class="btn-clear-all" onclick="clearAllNames()">X√ìA T·∫§T C·∫¢ DANH S√ÅCH</button>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>H·ªç T√™n</th>
                        <th>X√≥a</th>
                    </tr>
                </thead>
                <tbody id="admin-list-body"></tbody>
            </table>
        </div>
    </div>

    <h1 id="happynewyear" class="art-title">Xu√¢n B√≠nh Ng·ªç 2026</h1>

    <div id="shaker-container">
        <div id="tube"><div id="sticks-container"></div></div>
        <button id="draw-btn" class="btn-gold" style="display:none; margin-top:20px;" onclick="drawCard()">R√öT QU·∫∫ ƒê·∫¶U NƒÇM</button>
    </div>

    <div id="result-card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:320px; background:#fff; color:#000; padding:30px; border:10px double #d40000; text-align:center; z-index:2000; border-radius:20px;">
        <p style="font-style:italic">G·ª≠i: <b id="display-name" style="color:#d40000"></b></p>
        <h2 id="card-title" style="color:#8b0000; border-bottom:2px solid #ffd700; padding-bottom:10px; font-size: 1.3rem;"></h2>
        <p id="card-body" style="line-height:1.6; font-size:1rem;"></p>
        <button class="btn-gold" onclick="showLixiScreen()">NH·∫¨N L·ªòC L√å X√å</button>
    </div>

    <div id="lixi-screen" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:3000; flex-direction:column; align-items:center; justify-content:center;">
        <h2 style="color:#ffd700; margin-bottom:30px; text-shadow: 0 0 10px gold;">üßß H√ÅI HOA T√ÄI L·ªòC üßß</h2>
        <div class="lixi-grid" id="lixi-container"></div>
    </div>

    <div id="money-popup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:4000; text-align:center; width:100%;">
        <div style="font-size:2rem; color:#fff;">L·ªôc T√†i C·ªßa B·∫°n:</div>
        <div id="money-amount" style="font-size:5rem; color:#ffd700; font-weight:900; text-shadow: 0 0 30px #ff0000;"></div>
        <button class="btn-gold" onclick="location.reload()">CH√öC M·ª™NG NƒÇM M·ªöI</button>
    </div>

    <canvas id="canvas-fireworks"></canvas>
    <canvas id="canvas-petals"></canvas>

    <script>
        // Ch·∫∑n ph√≠m t·∫Øt
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && (e.keyCode === 67 || e.keyCode === 85)) e.preventDefault();
            if (e.keyCode === 123) e.preventDefault();
        });

        let userName = "";
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function showNameInput() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('name-input-box').style.display = 'block';
            document.getElementById('bg-music').play().catch(() => {});
        }

        // --- H√ÄM ADMIN C·∫¢I TI·∫æN ---
        function toggleAdminPanel() {
            const container = document.getElementById('admin-list-container');
            if (container.style.display === 'block') {
                container.style.display = 'none';
                return;
            }

            const pass = prompt("Nh·∫≠p m·∫≠t kh·∫©u Admin:");
            if (pass === "6302") {
                renderAdminList();
                container.style.display = 'block';
            } else if (pass !== null) {
                alert("M·∫≠t kh·∫©u sai!");
            }
        }

        function renderAdminList() {
            const listBody = document.getElementById('admin-list-body');
            let usedNames = JSON.parse(localStorage.getItem('tet2026_names') || "[]");
            listBody.innerHTML = "";
            
            usedNames.forEach((name, index) => {
                let row = `<tr>
                    <td align="center">${index + 1}</td>
                    <td>${name.toUpperCase()}</td>
                    <td align="center"><span class="btn-del" onclick="deleteSingleName(${index})">X√≥a</span></td>
                </tr>`;
                listBody.innerHTML += row;
            });
        }

        function deleteSingleName(index) {
            let usedNames = JSON.parse(localStorage.getItem('tet2026_names') || "[]");
            if (confirm(`X√≥a t√™n "${usedNames[index].toUpperCase()}" kh·ªèi danh s√°ch?`)) {
                usedNames.splice(index, 1);
                localStorage.setItem('tet2026_names', JSON.stringify(usedNames));
                renderAdminList();
            }
        }

        function clearAllNames() {
            if (confirm("C·∫¢NH B√ÅO: X√≥a to√†n b·ªô danh s√°ch t√™n ƒë√£ l∆∞u?")) {
                localStorage.removeItem('tet2026_names');
                renderAdminList();
                document.getElementById('admin-list-container').style.display = 'none';
                alert("ƒê√£ l√†m tr·ªëng danh s√°ch!");
            }
        }

        function isNameUsed(name) {
            let usedNames = JSON.parse(localStorage.getItem('tet2026_names') || "[]");
            return usedNames.includes(name.trim().toLowerCase());
        }

        function saveName(name) {
            let usedNames = JSON.parse(localStorage.getItem('tet2026_names') || "[]");
            usedNames.push(name.trim().toLowerCase());
            localStorage.setItem('tet2026_names', JSON.stringify(usedNames));
        }

        function startCountdown() {
            const inputVal = document.getElementById('username').value.trim();
            if (!inputVal) { alert("Vui l√≤ng nh·∫≠p qu√Ω danh!"); return; }
            if (isNameUsed(inputVal)) { alert("T√™n n√†y ƒë√£ nh·∫≠n l·ªôc r·ªìi!"); return; }

            userName = inputVal;
            saveName(userName);
            document.getElementById('display-name').innerText = userName;
            document.getElementById('name-input-box').style.display = 'none';
            document.getElementById('intro-screen').style.display = 'flex';
            document.querySelector('.touch-text').style.display = 'none';

            let t = 5;
            document.getElementById('timer').innerText = t;
            const iv = setInterval(() => {
                t--;
                if (t >= 0) document.getElementById('timer').innerText = t;
                if(t === 0) {
                    clearInterval(iv);
                    const curtainContainer = document.getElementById('curtain-container');
                    curtainContainer.style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('intro-screen').style.display = 'none';
                        document.getElementById('happynewyear').style.display = 'block';
                        curtainContainer.classList.add('open-curtain');
                        initFireworks();
                        const sc = document.getElementById('shaker-container');
                        sc.style.display = 'flex';
                        // CƒÉn ch·ªânh v·ªã tr√≠ th√≠ch ·ª©ng khi b·∫Øt ƒë·∫ßu hi·ªán ra
                        sc.style.left = '50%'; 
                        sc.style.top = window.innerWidth < 768 ? '55%' : '50%'; 
                        sc.style.transform = 'translate(-50%, -50%)';
                    }, 50);
                }
            }, 1000);
        }

        // Logic gieo qu·∫ª & L√¨ x√¨
        const sticksContainer = document.getElementById('sticks-container');
        for (let i = 0; i < 15; i++) {
            const s = document.createElement('div'); s.className = 'stick';
            s.style.transform = `rotate(${(i-7)*4}deg)`; s.style.left = `${40+(i*2)}px`;
            sticksContainer.appendChild(s);
        }

        const shaker = document.getElementById('shaker-container');
        const tube = document.getElementById('tube');
        let isDown = false, offset = {x:0, y:0}, lastX, lastY, lastT;

        const start = (e) => {
            isDown = true;
            const cx = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const cy = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            offset.x = cx - shaker.offsetLeft; offset.y = cy - shaker.offsetTop;
            lastX = cx; lastY = cy; lastT = Date.now();
        };

        const move = (e) => {
            if (!isDown) return;
            const cx = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const cy = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            shaker.style.left = cx - offset.x + 'px'; shaker.style.top = cy - offset.y + 'px';
            const speed = Math.sqrt(Math.pow(cx-lastX,2) + Math.pow(cy-lastY,2)) / (Date.now()-lastT);
            if (speed > 0.7) { tube.classList.add('shaking'); playTone(120, 'square', 0.05); }
            else tube.classList.remove('shaking');
            lastX = cx; lastY = cy; lastT = Date.now();
        };

        window.addEventListener('mousemove', move); window.addEventListener('mouseup', () => {isDown=false; tube.classList.remove('shaking'); if(document.getElementById('draw-btn')) document.getElementById('draw-btn').style.display='block';});
        shaker.addEventListener('mousedown', start); shaker.addEventListener('touchstart', start); window.addEventListener('touchmove', move); window.addEventListener('touchend', () => {isDown=false; tube.classList.remove('shaking'); if(document.getElementById('draw-btn')) document.getElementById('draw-btn').style.display='block';});

        function drawCard() {
            const ws = [
                {t: "QU·∫∫ ƒê·∫†I C√ÅT: M√É ƒê√ÅO TH√ÄNH C√îNG", b: "Ng·ª±a t·ªët ch·∫°y ƒë∆∞·ªùng d√†i, nƒÉm B√≠nh Ng·ªç n√†y v·∫≠n th·∫ø c·ªßa b·∫°n b√πng n·ªï m·∫°nh m·∫Ω. S·ª± nghi·ªáp thƒÉng ti·∫øn nh∆∞ di·ªÅu g·∫∑p gi√≥, t√†i l·ªôc d·ªìi d√†o g√µ c·ª≠a quanh nƒÉm."},
                {t: "QU·∫∫ TH∆Ø·ª¢NG C√ÅT: PH√öC T·ª∞A ƒê√îNG H·∫¢I", b: "NƒÉm m·ªõi ƒë√≥n nh·∫≠n sinh kh√≠ m·ªõi, s·ª©c kh·ªèe d·∫ªo dai nh∆∞ linh m√£. M·ªçi kh√≥ khƒÉn ƒë·ªÅu c√≥ qu√Ω nh√¢n ph√π tr·ª£, t√¨nh duy√™n vi√™n m√£n."},
                {t: "QU·∫∫ T·∫§N L·ªòC: KIM NG√ÇN M√ÉN ƒê∆Ø·ªúNG", b: "Ti·ªÅn v√¥ nh∆∞ n∆∞·ªõc, b·∫°c v√†ng ƒë·∫ßy kho. NƒÉm 2026 ch√≠nh l√† th·ªùi ƒëi·ªÉm v√†ng ƒë·ªÉ b·∫°n b·ª©t ph√° trong kinh doanh."},
                {t: "QU·∫∫ SONG H·ª∂: V·∫†N S·ª∞ NH∆Ø √ù", b: "B√≠nh Ng·ªç mang ƒë·∫øn ni·ªÅm vui nh√¢n ƒë√¥i. Gia ƒë√¨nh √™m ·∫•m, s·ª©c kh·ªèe d·ªìi d√†o, ti·ªÅn b·∫°c r·ªßng r·ªânh. Ch√∫c b·∫°n m·ªôt nƒÉm thu·∫≠n bu·ªìm xu√¥i gi√≥!"}
            ];
            const r = ws[Math.floor(Math.random()*ws.length)];
            document.getElementById('card-title').innerText = r.t;
            document.getElementById('card-body').innerText = r.b;
            document.getElementById('result-card').style.display = 'block';
            shaker.style.display = 'none';
            startPetals();
        }

        function showLixiScreen() {
            document.getElementById('result-card').style.display = 'none';
            document.getElementById('lixi-screen').style.display = 'flex';
            const container = document.getElementById('lixi-container');
            if(container.children.length === 0) {
                for(let i=0; i<8; i++) {
                    const item = document.createElement('div'); item.className = 'lixi-item';
                    item.onclick = (e) => openLixi(e); container.appendChild(item);
                }
            }
        }

        function openLixi(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            if(window.fireCustomBurst) { window.fireCustomBurst(centerX, centerY, '#FFD700'); window.fireCustomBurst(centerX, centerY, '#FF69B4'); }
            setTimeout(() => {
                const nums = [16888, 26666, 38888, 66666, 68686, 86868];
                const money = nums[Math.floor(Math.random()*nums.length)];
                document.getElementById('money-amount').innerText = money.toLocaleString() + "ƒë";
                document.getElementById('lixi-screen').style.display = 'none';
                document.getElementById('money-popup').style.display = 'block';
                playTone(1000, 'sine', 0.3);
            }, 500);
        }

        function playTone(f, t, d) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(0.03, audioCtx.currentTime);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        // --- C·∫¨P NH·∫¨T HI·ªÜU ·ª®NG PH√ÅO HOA CAO C·∫§P ---
        function initFireworks() {
            const canvas = document.getElementById('canvas-fireworks'); const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            let particles = []; let rockets = [];
            
            class Rocket {
                constructor(isMega = false) { 
                    this.x = Math.random() * canvas.width; 
                    this.y = canvas.height; 
                    this.isMega = isMega;
                    this.targetY = isMega ? (Math.random() * canvas.height * 0.2 + 50) : (Math.random() * (canvas.height * 0.4) + 100); 
                    this.speed = isMega ? 8 : (Math.random() * 4 + 4); 
                    this.color = isMega ? `hsl(${Math.random() * 360}, 100%, 70%)` : `hsl(${Math.random() * 360}, 100%, 60%)`; 
                }
                update() { 
                    this.y -= this.speed; 
                    if (this.y <= this.targetY) { 
                        explode(this.x, this.y, this.color, this.isMega); 
                        return false; 
                    } 
                    return true; 
                }
                draw() { 
                    ctx.save();
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = this.color;
                    ctx.fillStyle = this.color; 
                    ctx.fillRect(this.x, this.y, this.isMega ? 4 : 2, this.isMega ? 15 : 10); 
                    ctx.restore();
                }
            }
            
            class Particle {
                constructor(x, y, color, vx, vy, life) { 
                    this.x = x; this.y = y; this.color = color; this.vx = vx; this.vy = vy; 
                    this.alpha = 1; this.friction = 0.95; this.gravity = 0.1; 
                    this.decay = life || (Math.random() * 0.015 + 0.005);
                }
                update() { 
                    this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity; 
                    this.x += this.vx; this.y += this.vy; this.alpha -= this.decay; 
                }
                draw() { 
                    ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.beginPath(); 
                    ctx.arc(this.x, this.y, Math.random() * 2 + 1, 0, Math.PI * 2); ctx.fill(); 
                }
            }

            function explode(x, y, color, isMega) {
                const count = isMega ? 300 : 100;
                const strength = isMega ? 18 : 12;
                for (let i = 0; i < count; i++) { 
                    const angle = (Math.PI * 2 / count) * i + (Math.random() - 0.5); 
                    let speed = Math.random() * strength + 2; 
                    particles.push(new Particle(
                        x, y, 
                        isMega ? `hsl(${Math.random()*360}, 100%, 75%)` : color, 
                        Math.cos(angle) * speed, Math.sin(angle) * speed, 
                        isMega ? 0.006 : 0.015
                    )); 
                }
                playTone(isMega ? 80 : 180, 'sine', isMega ? 0.4 : 0.1);
            }

            window.fireCustomBurst = (x, y, color) => { 
                for (let i = 0; i < 50; i++) { 
                    const angle = Math.random() * Math.PI * 2; 
                    const speed = Math.random() * 10; 
                    particles.push(new Particle(x, y, color, Math.cos(angle) * speed, Math.sin(angle) * speed)); 
                } 
            };

            setInterval(() => {
                if(document.getElementById('happynewyear').style.display === 'block') {
                    rockets.push(new Rocket(true));
                }
            }, 2000);

            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                if (Math.random() < 0.05) rockets.push(new Rocket(false));
                rockets = rockets.filter(r => { 
                    const active = r.update(); 
                    if (active) r.draw(); 
                    return active; 
                });
                particles = particles.filter(p => { 
                    p.update(); 
                    p.draw(); 
                    return p.alpha > 0; 
                });
                requestAnimationFrame(animate);
            }
            animate();
            window.addEventListener('resize', () => { canvas.width = innerWidth; canvas.height = innerHeight; });
        }

        function startPetals() {
            const pC = document.getElementById('canvas-petals'); const pCtx = pC.getContext('2d');
            pC.width = innerWidth; pC.height = innerHeight;
            let pts = [];
            for(let i=0; i<40; i++) pts.push({x:Math.random()*innerWidth,y:-20,s:Math.random()*6+6,v:Math.random()*1+1,ang:Math.random()*360});
            function anim() {
                pCtx.clearRect(0,0,pC.width,pC.height);
                pts.forEach(p => {
                    p.y += p.v; p.ang += 1.5; p.x += Math.sin(p.y/50);
                    pCtx.save(); pCtx.translate(p.x,p.y); pCtx.rotate(p.ang*Math.PI/180);
                    pCtx.fillStyle='#ffb7c5'; pCtx.beginPath(); pCtx.moveTo(0,0);
                    pCtx.bezierCurveTo(-p.s,-p.s,-p.s,p.s/2,0,p.s); pCtx.bezierCurveTo(p.s,p.s/2,p.s,-p.s,0,0);
                    pCtx.fill(); pCtx.restore();
                    if(p.y > innerHeight) p.y = -20;
                });
                requestAnimationFrame(anim);
            }
            anim();
        }
    </script>
</body>
</html>